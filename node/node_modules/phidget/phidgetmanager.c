#include "phidgetmanager.h"

/*
 * code from phidgets c examples
 */
#define PHIDGETMANAGER_H_GLOBAL_VARIABLE
CPhidgetManagerHandle device;

// This error handler can handle any CPhidget function that returns an int
int localErrorCatcher(int errorCode) {
	const char *errorDescription;
    
	// If the error code is 0, everything is okay
    if (errorCode != 0) {
    
        // Otherwise, you can print specific messages or perform actions by error value.
        switch (errorCode) {
           default:
               printf("Error: An error occurred with code %d.\n", errorCode);
               
               localErrorCatcher(
                   CPhidget_getErrorDescription (errorCode, &errorDescription));
               printf("The description for this error is: %s\n", errorDescription);
               break;
       }
    }
	return 0;
}

int CCONV attachHandler(CPhidgetHandle device, void *userptr) {
    int serialNumber;
    const char *name;

    localErrorCatcher(
        CPhidget_getDeviceName(device, &name));
    localErrorCatcher(
        CPhidget_getSerialNumber(device, &serialNumber));
    
    printf("\nHello Device %s, Serial Number: %d\n", name, serialNumber);
    
    return 0;
}

int CCONV detachHandler(CPhidgetHandle device, void *userptr) {
    int serialNumber;
    const char *name;

    localErrorCatcher(
        CPhidget_getDeviceName(device, &name));
    localErrorCatcher(
        CPhidget_getSerialNumber(device, &serialNumber));
    
    printf("Goodbye Device %s, Serial Number: %d\n", name, serialNumber);
    
    return 0;
}

// When using an error handler with the manager, it takes a
// CPhidgetManagerHandle, when using an individual object, the
// object serves as its own handle.
int CCONV libraryErrorHandler(CPhidgetManagerHandle device, void *usrptr, 
                    int errorCode, const char *errorDescription) {
    printf("Error Event: %d - %s\n", errorCode, errorDescription);
    return 0;
}
